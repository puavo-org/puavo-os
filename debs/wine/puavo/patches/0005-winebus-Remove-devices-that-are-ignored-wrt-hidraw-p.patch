From fc813b415183fc1e0fccbd7278401e832e809e6f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Tue, 19 Mar 2024 12:29:50 +0100
Subject: [PATCH 5/6] winebus: Remove devices that are ignored wrt hidraw
 preferences.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=56450
---
 dlls/winebus.sys/main.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/dlls/winebus.sys/main.c b/dlls/winebus.sys/main.c
index 5244d7dda54..8d3b72d93f1 100644
--- a/dlls/winebus.sys/main.c
+++ b/dlls/winebus.sys/main.c
@@ -670,8 +670,10 @@ static DWORD CALLBACK bus_main_thread(void *args)
             if (desc.is_hidraw && !desc.usages.UsagePage) desc.usages = get_hidraw_device_usages(event->device);
             if (!desc.is_hidraw != !is_hidraw_enabled(desc.vid, desc.pid, &desc.usages))
             {
+                struct device_remove_params params = {.device = event->device};
                 WARN("ignoring %shidraw device %04x:%04x with usages %04x:%04x\n", desc.is_hidraw ? "" : "non-",
                      desc.vid, desc.pid, desc.usages.UsagePage, desc.usages.Usage);
+                winebus_call(device_remove, &params);
                 break;
             }
 
-- 
2.39.2

